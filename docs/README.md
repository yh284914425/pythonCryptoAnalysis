# 币安K线数据下载工具

这个工具可以从币安API下载完整的历史K线数据，支持增量更新和多时间周期。

## 功能特点

- ✅ **完整历史数据**: 自动获取币安上线以来的所有历史数据
- ✅ **增量更新**: 检查现有文件，只下载新数据
- ✅ **多时间周期**: 支持1h, 2h, 4h, 8h, 12h, 1d, 3d, 1w等周期
- ✅ **文件夹管理**: 所有数据保存在统一的`crypto_data`文件夹中
- ✅ **错误处理**: 网络异常和数据异常的处理
- ✅ **去重处理**: 自动去除重复的K线数据
- ✅ **时区支持**: 自动转换为北京时间显示

## 安装和设置

### 1. 克隆项目
```bash
git clone <your-repo-url>
cd crypto
```

### 2. 创建虚拟环境（推荐）
```bash
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# 或者 Windows:
# venv\Scripts\activate
```

### 3. 安装依赖
```bash
pip install -r requirements.txt
```

### 4. 验证安装
```bash
python3 -c "import pandas, requests, pytz; print('依赖安装成功！')"
```

## 使用方法

### 首次运行
```bash
python3 downData.py
```

第一次运行会下载所有历史数据，这可能需要一些时间。

### 增量更新
再次运行相同命令即可进行增量更新：
```bash
python3 downData.py
```

脚本会自动检测现有数据文件，并从最新数据开始更新。

## 数据存储

所有数据保存在`crypto_data`目录中，文件命名格式为：
- `BTCUSDT_1h.csv` - 1小时K线数据
- `BTCUSDT_1d.csv` - 1天K线数据
- `BTCUSDT_1w.csv` - 1周K线数据
- 等等...

## 数据格式

每个CSV文件包含以下字段：
- **开盘时间**: K线开始时间（北京时间）
- **开盘价**: 开盘价格
- **最高价**: 最高价格
- **最低价**: 最低价格
- **收盘价**: 收盘价格
- **成交量**: 基础资产成交量
- **收盘时间**: K线结束时间（北京时间）
- **成交额**: 计价资产成交量
- **成交笔数**: 交易次数
- **主动买入成交量**: 主动买入基础资产成交量
- **主动买入成交额**: 主动买入计价资产成交量
- **忽略**: 忽略字段

## 自定义配置

你可以修改`downData.py`文件中的以下参数：

```python
# 修改交易对
symbol = 'ETHUSDT'  # 改为以太坊

# 修改时间周期
intervals = ['1d', '1w']  # 只下载日线和周线

# 修改数据存储目录
data_dir = 'my_crypto_data'
```

## 依赖说明

- **pandas**: 数据处理和CSV文件操作
- **requests**: HTTP请求调用币安API
- **pytz**: 时区处理，确保正确显示北京时间

## 注意事项

1. **网络连接**: 确保网络连接稳定，下载过程中可能需要较长时间
2. **存储空间**: 确保有足够的磁盘空间，完整数据可能占用数百MB
3. **API限制**: 币安API有请求频率限制，脚本已内置延迟处理
4. **数据准确性**: 数据来源于币安官方API，但请自行验证重要交易决策
5. **时区说明**: 所有时间都转换为北京时间（UTC+8）显示

## 故障排除

### 网络错误
如果遇到网络错误，脚本会自动重试。你也可以稍后重新运行脚本。

### 数据缺失
如果发现数据有缺失，可以删除对应的CSV文件，重新运行脚本下载完整数据。

### 磁盘空间不足
清理不需要的文件，或修改`data_dir`参数到其他位置。

### 时区问题
脚本自动处理时区转换，所有显示时间都是北京时间。如需其他时区，请修改代码中的`beijing_tz`设置。 